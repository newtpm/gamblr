[["the-game-of-keno.html", "Chapter 5 The Game of Keno 5.1 Simulating A Game in R", " Chapter 5 The Game of Keno In the Virginia version of the game, players pick from 1 to 10 numbers or spots (from the population range of 1 to 80). The Lottery then randomly picks 20 numbers from the same 1 to 80 range and players win predetermined amounts based on the number of matches they have. Virginia Lottery have a good explanation in a 2-minute marketing video. 5.1 Simulating A Game in R Assuming the game is unbiased, we can simulate a single game quite easily. Lets play the 10-Spot game, one-time, waging $1. Below we pick 10 numbers from the population range in pick and then simulate a single games drawing of 20 numbers in draw. library(tidyverse) # load the required R packages library(readxl) spots &lt;- 10 # the number of spots in our simulated game set.seed(11) # so that random outcomes can be reproduced pick &lt;- sample(1:80, spots) sort(pick) # sorted for viewing convenience ## [1] 12 16 25 34 35 37 39 56 60 62 draw &lt;- sample(1:80, 20) sort(draw) ## [1] 3 6 7 8 10 11 12 25 34 39 40 45 47 49 52 60 67 68 77 80 Apparently, we have five matches in this particular game which sounds pretty promising as half of our 10 picks were selected. Below we fetch them with a formula. sort(draw[draw %in% pick]) # subset from draw when the number is found in pick ## [1] 12 25 34 39 60 Now we need to lookup the assocated Prize for our five matches from a 10-Spot game as per the published table in the Odds table of Virginia Lotterys Keno page. Which turns out to be a Prize of $3, or $2 net of our ticket cost. We have won 2x our wager which sounds like a nice return but note that the odds of such an outcome in the table above is 19 (read as 1 in 19) or a (5.26%) probability. 5.1.1 Fair Bets &amp; Expected Values A fair bet is one where your net expected value is the same as your cost. So if I were to bet $1 that a fair coin flip would be heads and it pays out $2, this would be a fair bet because my expected value (i.e. payout * probability or [$2 * 0.5] ) equals my wager of $1. You usually make fair bets with friends and family and the wagers are fully distributed to the players. One couldnt expect formal gambling games to be fair as the establishments need to be profitable, but how do you determine the level to which the game is biased against you? We use expected value (EV) as a means to determine this. 5.1.2 The play_keno Function Now that the basics of the game are understood, lets wrap that single game into a function for reuse in our simulation. Note that the manual prize lookup has been automated via a manually created prize_table. The output of the function is a small table with a single row and the games parameters. play_keno &lt;- function(spots, wager = 1) { pick &lt;- sample(1:80, spots) # same as above draw &lt;- sample(1:80, 20) # same as above matches &lt;- sum(pick %in% draw) # we don&#39;t care whichs number match, just the total prize &lt;- prize_table %&gt;% select(Match, contains(as.character(spots))) %&gt;% # isolate column for the game we are playing filter(Match == matches) %&gt;% #isolate the matches we made pull(2) # isolate just the numeric from the dataframe tmp &lt;- tibble(Spots = spots, Wager = wager, Matches = matches, Prize = prize * wager ) %&gt;% mutate(Net = Prize - Wager, Color = ifelse(Prize == 0, 1, 2)) # color mapping for our charts return(tmp) } prize_table &lt;- read_xlsx(&quot;./input/keno prizes.xlsx&quot;) # load our prize table set.seed(11) # to creat the same random outputs as above play_keno(10) # play a 10-Spot game ## # A tibble: 1 x 6 ## Spots Wager Matches Prize Net Color ## &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 10 1 5 3 2 2 The official game allows for wagers of $1 to $10 which multiplies the prize by the wagered amount. So if we had made a $5 wager above, our prize would have been $15 ($3 * 5). For simplicity and consistency, we are only going to consider wagers of $1 in our simulations as the probabilities hold, given the linear relationship of the prize to the wager. "],["lets-play-100000-games-of-keno.html", "Chapter 6 Lets Play 100,000 Games of Keno", " Chapter 6 Lets Play 100,000 Games of Keno Next we set our number of simulations to 100,00 and play_keno() for each sim. 100K sims are enough to reduce any random effect to a minimal level and we should feel confident in the approximate probabilities we derive. Our total simulation summary is shown below sims &lt;- 1e3 # 100K simulations which takes some time, so only play with 1000 sims until sure. plays &lt;- 1:sims %&gt;% # for each sim map_dfr(function(x) play_keno(spots)) %&gt;% # play a 10-Spot game with our function play_keno() mutate(Sim = 1:sims, # sim ID&#39;s Cumulative = cumsum(Net)) %&gt;% # calc cumulative sum relocate(Sim) # move Sim to the first column plays %&gt;% summarise(Sims = n(), Wager = sum(Wager), Prize = sum(Prize), Net = sum(Net), .groups = &quot;drop&quot;) %&gt;% mutate(Prob = round(Sims / sims, 3), EV = Prize / Sims * Prob) ## # A tibble: 1 x 6 ## Sims Wager Prize Net Prob EV ## &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 1000 1000 609 -391 1 0.609 For 1K simulations, we wagered $1K and lost $0.4K of it. Put another way, our expected value (EV) for the 10-Spot game is $0.61 Despite the best match levels expected value being only 15.6 cents (see below), our expected value for each game is 0 cents. This dynamic is due to the fact that players do not need to specify a match level beforehand. Thus, they participate in the payout at any winning level and their combined EV is the sum of all EVs. summary &lt;- plays %&gt;% group_by(Matches) %&gt;% summarise(Sims = n(), Wager = sum(Wager), Prize = sum(Prize), Net = sum(Net), .groups = &quot;drop&quot;) %&gt;% mutate(Prob = round(Sims / sims, 3), EV = Prize / Sims * Prob, Odds = round(1/EV, 0)) summary # results of our sims ## # A tibble: 8 x 8 ## Matches Sims Wager Prize Net Prob EV Odds ## &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 0 46 46 92 46 0.046 0.092 11 ## 2 1 173 173 0 -173 0.173 0 Inf ## 3 2 281 281 0 -281 0.281 0 Inf ## 4 3 267 267 0 -267 0.267 0 Inf ## 5 4 160 160 160 0 0.16 0.16 6 ## 6 5 59 59 177 118 0.059 0.177 6 ## 7 6 13 13 130 117 0.013 0.13 8 ## 8 7 1 1 50 49 0.001 0.05 20 Note: The simulated probability of getting 5 matches in the 10-Spot game is 5.2% - which is consistent with the stated odds (1/19) for five matches. This illustreates an value attribute of simulations - despite not knowing the formula that the Lottery used for their odds, we have been able to validate them as being acceptably accurate. "],["net-position-after-30-games-1.html", "Chapter 7 Net Position After 30 Games", " Chapter 7 Net Position After 30 Games With an EV of 0 cents. we would expect to have $0 in our pocket after wagering $30 across 30 games. But no one plays Keno for the expected value, it is the big prizes that attracts players. So lets play 30 games, 1,000 times, and see what our ending balances are after this defined gameset. games &lt;- 30 sims2 &lt;- 1000 plays2 &lt;- tibble() for (i in 1:sims2) { games_batch &lt;- 1:30 %&gt;% # for each sim map_dfr(function(x) play_keno(spots)) %&gt;% summarise(Net = sum(Net)) %&gt;% mutate(Sim = i) %&gt;% # calc cumulative sum relocate(Sim) plays2 &lt;- plays2 %&gt;% bind_rows(games_batch) %&gt;% mutate(Color = factor(case_when( Net &lt;= 0 ~ &quot;-$30 - $0 Loss&quot;, Net &gt; 0 &amp; Net &lt;= 30 ~ &quot;$1-$30 Gain&quot;, Net &gt; 30 &amp; Net &lt;= 60 ~ &quot;$31-$60 Gain&quot;, Net &gt; 60 &amp; Net &lt;= 90 ~ &quot;$61-$90 Gain&quot;, TRUE ~ &quot;&gt;$90 Gain&quot; ))) } ggplot(plays2, aes(Sim, Net, color = Color)) + geom_jitter(alpha = 0.3) + geom_hline(yintercept = mean(plays2$Net)) summ_plays2 &lt;- plays2 %&gt;% group_by(Color) %&gt;% summarise(Count = n(), Mean = mean(Net)) ## `summarise()` ungrouping output (override with `.groups` argument) ggplot(plays2, aes(Net)) + geom_histogram(binwidth = 30) "],["p.html", "Chapter 8 P", " Chapter 8 P "],["conclusion-1.html", "Chapter 9 Conclusion 9.1 Reconciling to Original (Manual in a Restaurant) Analysis", " Chapter 9 Conclusion 9.1 Reconciling to Original (Manual in a Restaurant) Analysis I realize now that my original calculation did not appreciate the sum of the EVs as being relevant (because players participate at all match levels in each game, rather then pre-specifying a match level). So my original EV was considerably understated. From this, we can draw some important lessons. Dont do probability after a couple of beers at lunch. Even when system probabilities are thought to be understood, a simulation will either prove it out or provide a better understanding. This has been a fun excercise, I hope you enjoyed it and learned a little bit about deriving probabilities when direct mathematical calculation is impractical. "]]
